## 撰写 LaTeX 和 R 的动态报告

### 1. 使用 Sweave 和 Knitr
#### 概述
R 包含了一个使用 LaTeX 来制作动态报告和可重复研究的强大系统（Sweave 包）。Sweave 使得 R 代码可以被嵌入在 LaTeX 文档中，并一起被编译为包含有文字叙述、分析、图形、R 代码及其计算结果的 PDF 报告。

Knitr 包在 Sweave 的基础上增加了更多功能，是一个更为强大和全面的系统。而 RStudio 为这两个包的主要功能提供了全面的支持。为了使用 Sweave 或 Knitr，除了 R 和 RStudio 之外，你需要在系统上安装一个 LaTeX 发行版。关于如何安装 LaTeX，可以参考 [LaTeX 项目](http://www.latex-project.org/ftp.html)的页面。


Sweave 的核心思想是在一个 Sweave 文档内同时撰写报告和 R 代码，并在输出的报告中自动包含代码运行的结果。这样做可以省去在代码和报告中不断来回复制粘贴的过程。所以 Sweave 文档由 LaTeX 和 R 代码“编织（weave/knit）”在一起组成，并使用一些标识符将两者区分。在编译时，Sweave 文档中的 R 代码首先被执行，其结果将会被插入对应代码的下方。这时整个文档中已经不包含未运行的 R 代码，所以 Sweave 文档也变成了普通的 LaTeX 文档。接着只需调用系统中的 LaTeX 编译器将其编译为 PDF 即可。这两个过程是由不同的系统完成的，但在 RStudio 下，用户可以一键完成整个过程。

#### 创建新的文档
当你要创建一个新的 Sweave 文档时，选择菜单中的 **File ->> New ->> R Sweave**。新建的文档中包含了默认的模板，你可以随意的在其中输入文字和 LaTeX 命令。当需要在文档中插入 R 代码块（chunk）时，Sweave 文档的编辑器窗口右上角会有一个特殊的 chunk 菜单，有关 chunk 的操作都可以在这个菜单中找到。

![](http://www.rstudio.com/images/docs/sweave_chunk.png)

你可以用工具栏上的 **Compile PDF** 按钮将整个文档编译为一个 PDF 文件。
 
需要注意的是，为了使得这个过程是可重复的，整个文档中的 R 代码会在一个新的 R 环境（非当前的工作空间）中运行。这是为了保证代码每次都会产生同样地结果而不受当前工作空间中已经存在的对象的影响。从这个角度来说，文档是“独立”的，所有文档中需要用到的数据、变量都需要在文档中导入和创建，而不能简单地引用当前工作空间中的对象。这也引出了动态报告的概念 -- 当数据或分析方法变化时，报告只需要重新编译一次即可随之“更新”。

#### 自定义编译设置

##### 全局编译设置
在 RStudio 中，你可以设置使用什么程序来编译一个 Sweave 文档（后缀名为 `.Rnw`）。刚才已经介绍过， Rnw 的编译分为两步：首先运行 R 代码并把结果嵌入，然后编译 LaTeX 文档为 PDF 文件。这两步涉及到的程序及其选项都可在 RStudio 的设置菜单中的 Sweave 选项卡中
找到。

![](http://www.rstudio.com/images/docs/options_sweave.png)

其中，“编织” Rnw 文档的工具有 Sweave 和 Knitr 两种，如果选择 Knitr，你需要手动安装 Knitr 包，而 Sweave 是随 R 附带的。

而 LaTeX 编译选项中，XeLaTeX 可以使用系统字体，相较 pdfLaTeX 更快、更灵活。

##### 项目编译选项
上述设置方法影响的是全局设定，在你不处于任何一个项目内时这些设置才有效。这些设置也影响了你创建一个新项目时编译选项的默认值。如果需要对每个项目设置不同的编译选项，可以在菜单栏或右上角的快捷方式中找到 **Project ->> Project Options**，这里可以设置项目的编译选项。

![](http://www.rstudio.com/images/docs/project_options_sweave.png)


##### 文件编译设置
同时你可以设置每个文件的编译选项，这在处理多个 Rnw 文件，尤其是需要将来自不同合作者的 Rnw 文件组织在一起时非常有用。

如果需要将某个 Rnw 文件的编译选项设置为 knitr，可以在文件的第一行加入以下代码。

	% !Rnw weave = knitr
	
如果想设置为 Sweave，则把对应的 `knitr` 改为 `Sweave` 即可。

---

### 2. 撰写中文 LaTeX 文档
#### 概述





### 3. 处理多个 Rnw 文件
